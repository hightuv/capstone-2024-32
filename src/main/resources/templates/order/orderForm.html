<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" th:href="@{/css/orderForm.css}">
    <title>Title</title>
</head>
<body class="">
    <div class="wrapper">
        <div class="screen-backdrop"></div>
        <div class="screen home-screen">
            <div class="head-wrapper">
                <div class="menu-btn">
                    <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="w-6 h-6"
                    >
                        <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"
                        />
                    </svg>
                </div>
                <div class="welcome">
                    <div class="content">
                        <h1>메뉴</h1>
                        <p>원하시는 메뉴를 주문하세요!</p>
                    </div>
                    <div class="img">
                        <img src="/images/baekdabang.png" alt=""> <!-- 음식점 로고 사진 -->
                    </div>
                </div>
            </div>

            <!-- categories -->
            <div class="categories-wrapper">
                <div class="categories">
                    <th:block th:each="category : ${categories}">
                        <h1 th:text="${category.name}">카테고리명</h1>
                        <div class="category">
                            <input type="hidden" th:value="${category.id}" class="categoryId">
                            <th:block th:each="item : ${category.items}">
                                <div class="item">
                                    <div class="left">
                                        <div class="content">
                                            <input type="hidden" th:value="${item.id}" class="itemId">
                                            <h1 th:text="${item.name}">아이템 이름</h1>
                                            <p th:text="${item.price} + '원'">아이템 가격</p>
                                        </div>
                                        <div class="buttons">
                                            <button class="addCart" th:attr="itemId=${item.id}" onclick="addToCart(this)">담기</button>
                                            <button class="detail" th:attr="itemId=${item.id}" onclick="showItemDetail(this)">상세보기</button>
                                        </div>
                                    </div>
                                    <img th:src="${item.itemImageUrl}" alt="">
                                </div>
                            </th:block>
                        </div>
                    </th:block>
                </div>
            </div>
        </div>

        <div class="screen item-screen">
            <div class="head-wrapper">
                <div class="back-btn">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="w-6 h-6"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6.75 15.75L3 12m0 0l3.75-3.75M3 12h18"
                        />
                    </svg>
                </div>
            </div>
            <div class="item-details">
                <img class="image" src="/images/burger.jpg" alt="">
                <div class="details">
                    <h1 class="itemName">이름</h1>
                    <p class="description">설명</p>
                    <p class="price">가격</p>
                </div>
            </div>
            <div class="reviews-wrapper">
                <div class="reviews">
                    <div class="review-wrapper">
                        <div class="review">
                            <p>리뷰내용</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 장바구니 버튼 -->
        <div class="cart-btn">
            <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 4h1.5L9 16m0 0h8m-8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm-8.5-3h9.25L19 7H7.312"/>
            </svg>
        </div>

        <div class="black-backdrop"></div>
        <div class="cartTab">
            <div class="cart-backdrop"></div>
            <h1 class="heading">장바구니</h1>
            <form class="cart" method="post">
                <div class="orderItems">

                </div>
            </form>
            <div class="btns">
                <button type="button" class="order-btn" onclick="submitOrder()">주문하기</button>
            </div>
        </div>
    </div>



    <script th:src="@{/js/orderForm.js}"></script>
    <script th:inline="javascript">
        let items = [[${items}]];
        const details = document.querySelector(".item-details");
        function showItemDetail(element) {
            let itemId = parseInt(element.getAttribute("itemId"));
            let item = findItemById(itemId);
            wrapper.classList.toggle('show-item');
            details.querySelector(".image").src = item.itemImageUrl;
            details.querySelector(".itemName").innerHTML = item.name;
            details.querySelector(".description").innerHTML = item.description;
            details.querySelector(".price").innerHTML = item.price + '원';
        }

        function findItemById(id) {
            return items.find(item => item.itemId == id);
        }

        async function submitOrder() {
            alert(JSON.stringify(orderItems));
            let response = await fetch('', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(orderItems),
                credentials: 'include'
            });
            alert(response.status);
            if (await response.text() === 'true') {
                window.location.replace("/order/success");
            }
            else {
                alert('주문 오류');
            }
        }
    </script>
</body>
</html>